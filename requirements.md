# Требования к функциональности «Каршеринг»
[Макеты требований в Figma](https://www.figma.com/file/42mNwme0cBfZwNZUIcN1mh/Яндекс.Маршруты?node-id=2%3A18586 "Figma")

Пользователю нужно открыть Яндекс.Маршруты и корректно заполнить поля «Откуда» и «Куда». Приложение построит маршрут, а под полями «Откуда» и «Куда» отобразятся режимы поездки: «Оптимальный», «Быстрый», «Свой».
- Если выбрать режим «Оптимальный» или «Быстрый», система автоматически назначит способ передвижения: на авто, пешком, на такси, на самокате, на велосипеде, на каршеринге. Выбрать его самостоятельно нельзя — иконки неактивны.
- Если выбрать режим «Свой», способ передвижения можно поменять — иконки активны.
### Аренда машины
Арендовать машину можно в двух случаях: 
- Если приложение предлагает тип транспорта «Каршеринг» в режиме «Оптимальный» или «Быстрый».
- Если пользователь выбирает тип транспорта «Каршеринг» в режиме «Свой».

Под названиями режимов появится информация о стоимости и продолжительности поездки, а также кнопка «Забронировать».

Если нажать кнопку «Забронировать», вместо панели с названиями режимов появится форма бронирования. В форме нужно выбрать тариф, добавить информацию о водительских правах, указать способ оплаты. Дополнительно можно перечислить требования к заказу. 

Под «Требованиями к заказу» расположена кнопка «Забронировать». См. таблицу «Состояние кнопки».

Если пользователь передумал арендовать машину, он может вернуться назад — это иконка со стрелкой влево. На экране снова откроется блок, где нужно выбрать способ передвижения.

### Форма бронирования
На экране бронирования можно удалять адреса — они необязательны для заказа каршеринга. Пользователь может выбрать нужную машину на карте.
### Ограничения полей
| Имя               | тип поля | возможные значения | обязательность
| ------------------|:--------:|:------------------:|:----------------:| 
| Откуда	|текстовое поле |	Только буквы русского алфавита, цифры, пробел, тире, точка, запятая. Длина не менее 5 и не более 50 символов. Пробелы до и после адреса исчезают при снятии фокуса. Если пользователь не соблюдает любое из требований, рамка поля подсвечивается красным, а под ней появляется текст ошибки: «Введите корректный адрес». |	No |
| Куда	|текстовое поле	| Только буквы русского алфавита, цифры, пробел, тире, точка, запятая. Длина не менее 5 и не более 50 символов. Пробелы до и после адреса исчезают при снятии фокуса. Если пользователь не соблюдает любое из требований, рамка поля подсвечивается красным, а под ней появляется текст ошибки: «Введите корректный адрес». |	No | 
|Выбор тарифа каршеринга | одиночный выбор	| Один из вариантов: «Повседневный», «Походный», «Роскошный».	| Yes |
| Права |	текстовые поля | В поля «Имя» и «Фамилия» можно ввести только буквы русского алфавита. В поля «Дата рождения» и «Номер» — только цифры. См. ограничения поля «Добавить права».|	Yes |
| Способ оплаты	| одиночный выбор |	Пользователю доступен один способ оплаты — карта. В поля «Номер карты» и «Код» можно ввести только цифры. См. ограничения поля «Способ оплаты». |	Yes |
|Требования к заказу	|выпадающее меню|	При клике появляется панель с дополнительными параметрами. См. пункт «Требования к заказу».	|No|

По умолчанию выбран тариф «Повседневный», поля «Добавить права» и «Способ оплаты» не заполнены. 
Выбранный тариф подсвечивается серым. Под ним расположен блок с деталями тарифа и информацией о ближайшей машине:
- марка;
- описание тарифа;
- время в пути от пункта «Откуда» до машины — не будет отображаться, если пользователь удалит адрес в поле «Откуда»;
- время бесплатного ожидания;
- изображение машины;
- дополнительные параметры.
Система автоматически выбирает ту машину, которая находится ближе всего к пользователю. На карте иконка ближайшей машины увеличивается, над ней появляется чёрная плашка с маркой машины. 
Остальные свободные машины продолжают отображаться на карте в виде иконок. При этом показываются автомобили всех тарифов. Пользователь может выбрать машину на карте и забронировать: он нажимает на иконку, она увеличивается, над ней появляется чёрная плашка с маркой, а на левой панели — обновлённая информация о машине.
Если пользователь ещё не привязал банковскую карту, вместо слова «Карта» стоит слово «Добавить». Без карты забронировать машину нельзя.
По умолчанию приложение показывает точную стоимость поездки. Она рассчитывается по формуле — см. пункт «Формула расчёта тарифов». Если удалить хотя бы один адрес из полей «Откуда» или «Куда», отобразится стартовая цена за минуту.

### Стартовые цены тарифов (когда нет адреса)
| Тариф               | Цена/мин |
| --------------------|:--------:|
| Повседневный	      | 6 р/мин |
| Походный            |	17 р/мин |
| Роскошный           |	34 р/мин |

 ### Панель «Выбор тарифа»
Есть три тарифа. Каждый элемент состоит из иконки автомобиля, названия тарифа, цены.

Один из тарифов всегда выбран. По умолчанию это тариф «Повседневный», но его можно изменить. 
### Описания тарифов
| Тариф | Марка | Заголовок | Подзаголовок | Фичи |
| ------|:-----:|:---------:|:------------:|:----:|
| Повседневный | BMW 750	| Просто по делам, ничего лишнего |	n мин — 15 минут бесплатного ожидания	| - видеорегистратор - зарядка для телефона |
| Походный |	Kia Rio	| Для путешествий | n мин — 12 минут бесплатного ожидания	|- Bluetooth-двери - походное снаряжение |
| Роскошный	| Porsche 911	|Блеск, мощь, глянец | n мин — 10 минут бесплатного ожидания	| - светомузыка - напитки для гостей |

### Формула расчёта стоимости тарифов
Стоимость тарифа рассчитывается по формуле:

*фиксированная стоимость аренды в рублях + (60 * стоимость минуты поездки в рублях * продолжительность поездки в часах) * коэффициент тарифа = стоимость поездки*

Например, стоимость поездки по тарифу «Повседневный»:

*150 + (60 * 6 * 1.25) * 1.5 = 825*

#### Пояснения к формуле:

- **150** — фиксированная стоимость аренды в рублях;
- **60** — минут в одном часе;
- **6** — стоимость минуты поездки на каршеринге в рублях;
- **1.25** — продолжительность поездки в часах;
- **1.5** — коэффициент тарифа «Повседневный».

#### Коэффициенты:

- Повседневный: 1.5.
- Походный: 2.
- Роскошный: 3.

### Поле «Добавить права»
Если не добавить водительское удостоверение, забронировать машину не получится.  

По умолчанию поле «Добавить права» не заполнено. Когда пользователь нажимает на поле, появляется окно «Добавление прав». В нём нужно ввести имя, фамилию, дату рождения и номер водительского удостоверения. 

Текст, который вводит пользователь, чёрного цвета. 

Когда пользователь внёс все данные, появляется сообщение: «Спасибо! Документы отправлены на проверку. Скоро расскажем о результатах». Под сообщением — кнопка «Понятно». 

Если нажать кнопку «Понятно», окно закроется, а в поле «Добавить права» появится таймер на 30 секунд. Через 30 секунд система сообщает, прошли ли документы верификацию.

### Ограничения поля «Добавить права»
| Имя               | тип поля | возможные значения | обязательность
| ------------------|:--------:|:------------------:|:----------------:| 
| Имя	| текстовое поле	| Только буквы русского алфавита, пробел, тире. Длина не менее 2 и не более 14 символов. Если пользователь не соблюдает любое из требований, поле подсвечивается красным, появляется текст ошибки: «Введите корректное имя».	| Yes |
| Фамилия	|текстовое поле	| Только буквы русского алфавита, пробел, тире. Длина не менее 2 и не более 14 символов. Если пользователь не соблюдает любое из требований, поле подсвечивается красным, появляется текст ошибки: «Введите корректную фамилию».	| Yes |
| Дата рождения	| цифры	|Формат дд.мм.гггг Только цифры. Ограничения для дд — от 01 до 31 включительно. Ограничения для мм — от 01 до 12 включительно. Ограничения для гггг — от 1880 до 2006 включительно. Точки ставятся автоматически, когда пользователь введёт дату рождения и снимет фокус. Система не даёт вводить иные символы или цифры, которые не входят в диапазон требований.	| Yes | 
| Номер	| цифры	| Формат nn nn nnnnnn Только цифры. Ограничения для nn — от 01 до 99 включительно. Ограничения для nnnnnn — от 000001 до 999999 включительно. Пробелы ставятся автоматически, когда пользователь введёт номер и снимет фокус.  Система не даёт вводить иные символы или цифры, которые не входят в диапазон требований.	| Yes |
#### После верификации
Если документы прошли верификацию, рамка поля подсвечивается зелёным, у правого края внутри поля появляется зелёная галочка. Пользователь больше не сможет редактировать данные водительского удостоверения. Несколько водительских удостоверений добавить нельзя. 

Если документы не прошли верификацию, рамка поля подсвечивается красным, у правого края внутри поля появляется красный крестик. Если нажать на поле, снова откроется форма «Добавление прав». Над формой — текст сообщения: «Ваши документы не прошли верификацию. Попробуйте ещё раз».

### Поле «Способ оплаты»
По умолчанию поле не заполнено. Чтобы забронировать машину, нужно ввести реквизиты хотя бы одной карты и нажать кнопку «Привязать». Можно добавить неограниченное количество карт. 

При нажатии на поле «Способ оплаты» открывается окно «Способ оплаты» с возможностью привязать новую карту или выбрать уже привязанную.

Чтобы добавить новую, нужно нажать на кнопку «Добавить карту». После этого откроется окно «Добавление карты».

При успешном добавлении новой карты и нажатии на кнопку «Привязать» происходит переход обратно на форму выбора карт.

Чтобы выбрать карту, её нужно отметить и нажать на кнопку выхода из формы. Если карта одна, она выбирается автоматически.

После выхода из формы поле «Способ оплаты» заполнено данными выбранной карты.

#### Окно «Добавление карты»:
Внутри есть поле «Номер карты», поле «Код», кнопка «Привязать» и кнопка «Отмена». Кнопка «Привязать» активируется, когда пользователь ввёл реквизиты карты — номер и код.
### Ограничения окна «Добавление карты»
| Имя               | тип поля |
| ------------------|:--------:|
| Номер карты	| Формат nnnn nnnn nnnn Только цифры. 12 символов. Ограничения для nnnn — от 0000 до 9999 включительно. Пробелы ставятся автоматически, когда пользователь введёт номер и снимет фокус.  Если ввести меньше 12 символов, кнопка «Привязать» остаётся неактивной. Больше 12 символов ввести нельзя. Система не даёт вводить иные символы или цифры, которые не входят в диапазон требований. |
| Код	Формат | nn Только цифры. 2 символа. Ограничения для nn — от 01 до 99 включительно. Если ввести меньше 2 символов, кнопка «Привязать» остаётся неактивной. Больше 2 символов ввести нельзя.  Система не даёт вводить иные символы или цифры, которые не входят в диапазон требований. | 

Когда карта добавлена, в интерфейсе отображаются последние 4 цифры её номера. Так пользователь может узнавать и отличать свои карты.

### Панель «Требования к заказу»
Это выпадающий список. Он свёрнут, если выбран тариф по умолчанию — «Повседневный». Если пользователь выбирает другой тариф, список автоматически раскрывается. И наоборот: если вернуться к тарифу «Повседневный», панель «Требования к заказу» свернётся. 

У каждого тарифа содержимое панели разное. 

Панель можно скроллить.
### Требования к заказу
| Тариф             | Состояние панели | Содержимое панели | Вид | Действие | 
| ------------------|:----------------:|:-----------------:|:----:|:-------:| 
| Повседневный	| Закрыто	| Зарядка для телефона	| Чекбокс	| Выбран/не выбран |
|              |         | Светомузыка Доступно в тарифе «Роскошный» | Кнопка/гиперссылка | Меняет тариф на «Роскошный» |                     
| Походный | Раскрывается автоматически | 1. Спрей от комаров 2. Спальник | 1. Счётчик 2. Счётчик | Ограничения на счётчик: - спрей от 0 до 2 включительно; - спальник от 0 до 5 включительно |  
|              |         | Светомузыка Доступно в тарифе «Роскошный» | Кнопка/гиперссылка | Меняет тариф на «Роскошный» | 
| Роскошный	| Раскрывается автоматически	| Светомузыка	| Чекбокс	| Выбран/не выбран |
|              |         | Развлечься 1. Шампанское для пассажиров 2. Вино для пассажиров | Радиокнопка | Можно выбрать только 1 вариант |  
|              |         | 2. Очки для крутоты | Счётчик | Ограничения на счётчик: от 0 до 3 включительно |   

### Кнопка «Забронировать»
Кнопка закреплена в левом нижнем углу экрана. 
### Состояние кнопки
| Заполненность полей | Текст | Действие | 
| ------------------|:----------------:|:-----------------:|
| Все обязательные поля и адреса заполнены	| Забронировать| Маршрут составит .. км и займет .. мин	| Появляется окно «Машина забронирована»|
| Все обязательные поля и адреса заполнены, кроме прав	| Добавить права и забронировать | Маршрут составит .. км и займет .. мин	Появляется окно «Добавление прав» |
| Все обязательные  поля и адреса заполнены, кроме способа оплаты	| Добавить оплату и забронировать | Маршрут составит .. км и займет .. мин	Появляется окно «Добавление карты» |
| Все обязательные  поля заполнены, адреса удалены	| Забронировать	| Появляется окно «Машина забронирована» |
| Обязательные поля не заполнены и адреса удалены	| Добавить права и забронировать	| Появляется окно «Добавление прав» |
### Бронь машины
Если пользователь корректно заполнил все поля и нажал кнопку «Забронировать», в центре экрана появится окно с заголовком «Машина забронирована». Внутри — марка, номер, иконка и адрес машины, а также стоимость поездки и таймер, который отсчитывает время бесплатного ожидания. 

Если поля «Откуда» и «Куда» заполнены, отображается точная стоимость поездки. Если нет — стоимость за минуту.
#### Таймер
- Таймер начинает отсчитывать время бесплатного ожидания, когда пользователь нажимает кнопку «Забронировать».
- Пока таймер работает, можно бесплатно отменить заказ.
- Когда время бесплатного ожидания заканчивается, таймер начинает отсчитывать время пользования каршерингом.
